!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.texLineBreak_lib=e():t.texLineBreak_lib=e()}("undefined"!=typeof self?self:this,(()=>{return t={573:t=>{function e(t){var e=[],n=0;if(this.trie=this.createTrie(t.patterns),this.leftMin=t.leftmin,this.rightMin=t.rightmin,this.exceptions={},t.exceptions)for(e=t.exceptions.split(/,\s?/g);n<e.length;n+=1)this.exceptions[e[n].replace(/\u2027/g,"").toLowerCase()]=new RegExp("("+e[n].split("‧").join(")(")+")","i")}e.TrieNode,e.prototype.createTrie=function(t){var e,n=0,u=0,o=0,i=0,r=null,s=null,a=null,l=null,h={_points:[]};for(n in t)if(t.hasOwnProperty(n))for(e=t[n].match(new RegExp(".{1,"+ +n+"}","g")),u=0;u<e.length;u+=1){for(r=e[u].replace(/[0-9]/g,"").split(""),s=e[u].split(/\D/),l=h,o=0;o<r.length;o+=1)l[a=r[o].charCodeAt(0)]||(l[a]={}),l=l[a];for(l._points=[],i=0;i<s.length;i+=1)l._points[i]=s[i]||0}return h},e.prototype.hyphenateText=function(t,e){e=e||4;for(var n=t.split(/([a-zA-Z0-9_\u0027\u00AD\u00DF-\u00EA\u00EB\u00EC-\u00EF\u00F1-\u00F6\u00F8-\u00FD\u0101\u0103\u0105\u0107\u0109\u010D\u010F\u0111\u0113\u0117\u0119\u011B\u011D\u011F\u0123\u0125\u012B\u012F\u0131\u0135\u0137\u013C\u013E\u0142\u0144\u0146\u0148\u0151\u0153\u0155\u0159\u015B\u015D\u015F\u0161\u0165\u016B\u016D\u016F\u0171\u0173\u017A\u017C\u017E\u017F\u0219\u021B\u02BC\u0390\u03AC-\u03CE\u03F2\u0401\u0410-\u044F\u0451\u0454\u0456\u0457\u045E\u0491\u0531-\u0556\u0561-\u0587\u0902\u0903\u0905-\u090B\u090E-\u0910\u0912\u0914-\u0928\u092A-\u0939\u093E-\u0943\u0946-\u0948\u094A-\u094D\u0982\u0983\u0985-\u098B\u098F\u0990\u0994-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BE-\u09C3\u09C7\u09C8\u09CB-\u09CD\u09D7\u0A02\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A14-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A82\u0A83\u0A85-\u0A8B\u0A8F\u0A90\u0A94-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABE-\u0AC3\u0AC7\u0AC8\u0ACB-\u0ACD\u0B02\u0B03\u0B05-\u0B0B\u0B0F\u0B10\u0B14-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3E-\u0B43\u0B47\u0B48\u0B4B-\u0B4D\u0B57\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB5\u0BB7-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C02\u0C03\u0C05-\u0C0B\u0C0E-\u0C10\u0C12\u0C14-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3E-\u0C43\u0C46-\u0C48\u0C4A-\u0C4D\u0C82\u0C83\u0C85-\u0C8B\u0C8E-\u0C90\u0C92\u0C94-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBE-\u0CC3\u0CC6-\u0CC8\u0CCA-\u0CCD\u0D02\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D28\u0D2A-\u0D39\u0D3E-\u0D43\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D60\u0D61\u0D7A-\u0D7F\u1F00-\u1F07\u1F10-\u1F15\u1F20-\u1F27\u1F30-\u1F37\u1F40-\u1F45\u1F50-\u1F57\u1F60-\u1F67\u1F70-\u1F7D\u1F80-\u1F87\u1F90-\u1F97\u1FA0-\u1FA7\u1FB2-\u1FB4\u1FB6\u1FB7\u1FBD\u1FBF\u1FC2-\u1FC4\u1FC6\u1FC7\u1FD2\u1FD3\u1FD6\u1FD7\u1FE2-\u1FE7\u1FF2-\u1FF4\u1FF6\u1FF7\u200D\u2019]+)/gi),u=0;u<n.length;u+=1)-1!==n[u].indexOf("/")?0===u||u===n.length-1||/\s+\/|\/\s+/.test(n[u])||(n[u]+="​"):n[u].length>e&&(n[u]=this.hyphenate(n[u]).join("­"));return n.join("")},e.prototype.hyphenate=function(t){var e,n,u,o,i,r,s,a,l,h=[],c=[],d=t.toLowerCase(),p=Math.max,f=this.trie,g=[""];if(this.exceptions.hasOwnProperty(d))return t.match(this.exceptions[d]).slice(1);if(-1!==t.indexOf("­"))return[t];for(e=(t="_"+t+"_").toLowerCase().split(""),n=t.split(""),s=e.length,u=0;u<s;u+=1)c[u]=0,h[u]=e[u].charCodeAt(0);for(u=0;u<s;u+=1)for(r=f,o=u;o<s&&(r=r[h[o]]);o+=1)if(a=r._points)for(i=0,l=a.length;i<l;i+=1)c[u+i]=p(c[u+i],a[i]);for(u=1;u<s-1;u+=1)u>this.leftMin&&u<s-this.rightMin&&c[u]%2?g.push(n[u]):g[g.length-1]+=n[u];return g},t.exports=e},382:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.layoutText=e.layoutItemsFromString=void 0;const u=n(839);function o(t,e,n,o=[]){const i=[],r=t.split(/(\s+)/).filter((t=>t.length)),s=e(" "),a=e("-"),l=.5*s,h=.333*s;console.log("Shrink to: ",h),console.log("Stretch to: ",h);let c=0;return r.forEach((t=>{if((t=>/\s/.test(t.charAt(0)))(t))return void i.push({type:"glue",width:s,shrink:h,stretch:l,text:t});const u=o[c++],r=t=>i.push({type:"box",width:e(t,u),text:t,meta:u});if(n){const e=n(t,u);e.forEach(((t,n)=>{r(t),n<e.length-1&&i.push({type:"penalty",width:a,cost:10,flagged:!0})}))}else r(t)})),i.push({type:"glue",width:0,stretch:u.MAX_COST,shrink:0,text:""}),i.push((0,u.forcedBreak)()),i}e.layoutItemsFromString=o,e.layoutText=function(t,e,n,i,r){let s,a,l;try{s=o(t,n,void 0,r),a=(0,u.breakLines)(s,e,{maxAdjustmentRatio:1}),l=(0,u.positionItems)(s,e,a)}catch(h){if(!(h instanceof u.MaxAdjustmentExceededError))throw h;s=o(t,n,i,r),a=(0,u.breakLines)(s,e),l=(0,u.positionItems)(s,e,a)}return{items:s,breakpoints:a,positions:l}}},240:function(t,e,n){"use strict";var u=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.justifyContent=e.unjustifyContent=void 0;const o=n(839),i=n(709),r=u(n(685)),s="insertedByTexLinebreak";function a(t,e,n,u,i=!0){if(Array.from(e.childNodes).forEach((e=>{e instanceof Text?function(t,e,n,u){const o=e.nodeValue,i=e.parentNode,r=n(i," "),s=.5*r,a=.333*r;console.log("Shrinking to: ",a);const l=n(i,"-"),h=o.split(/(\s+)/).filter((t=>t.length>0));let c=0;h.forEach((o=>{if(/\s/.test(o.charAt(0))){const n={type:"glue",width:r,shrink:a,stretch:s,node:e,start:c,end:c+o.length};return t.push(n),void(c+=o.length)}if(u){const r=u(o);r.forEach(((u,o)=>{const s={type:"box",width:n(i,u),node:e,start:c,end:c+u.length};if(c+=u.length,t.push(s),o<r.length-1){const n={type:"penalty",width:l,cost:10,flagged:!0,node:e,start:c,end:c};t.push(n)}}))}else{const u={type:"box",width:n(i,o),node:e,start:c,end:c+o.length};c+=o.length,t.push(u)}}))}(t,e,n,u):e instanceof Element&&function(t,e,n,u){const{display:o,width:i,paddingLeft:r,paddingRight:s,marginLeft:l,marginRight:h,borderLeftWidth:c,borderRightWidth:d}=getComputedStyle(e);if("inline"===o){const o=parseFloat(l)+parseFloat(c)+parseFloat(r);o>0&&t.push({type:"box",width:o,node:e,start:0,end:0}),a(t,e,n,u,!1);const i=parseFloat(h)+parseFloat(d)+parseFloat(s);if(i>0){const n=e.childNodes.length;t.push({type:"box",width:i,node:e,start:n,end:n})}}else t.push({type:"box",width:parseFloat(i),node:e,start:0,end:1})}(t,e,n,u)})),i){const n=e.childNodes.length;t.push({type:"glue",width:0,shrink:0,stretch:1e3,node:e,start:n,end:n}),t.push(Object.assign(Object.assign({},(0,o.forcedBreak)()),{node:e,start:n,end:n}))}}function l(t){t[s]=!0}function h(t){return t.hasOwnProperty(s)}function c(t){const e=[];for(let n=0;n<t.childNodes.length;n++){const u=t.childNodes[n];h(u)&&e.push(u),u.childNodes.length>0&&e.push(...c(u))}return e}function d(t){return t instanceof Text||t instanceof Element&&"inline"===getComputedStyle(t).display}function p(t){const e=c(t);for(let t of e){const e=t.parentNode;Array.from(t.childNodes).forEach((n=>{e.insertBefore(n,t)})),e.removeChild(t)}t.normalize()}e.unjustifyContent=p,e.justifyContent=function(t,e){Array.isArray(t)||(t=[t]),t.forEach((t=>{p(t)}));const n=new r.default,u=n.measure.bind(n),s=[];t.forEach((t=>{const n=function(t){const{width:e,boxSizing:n,paddingLeft:u,paddingRight:o}=getComputedStyle(t);let i=parseFloat(e);return"border-box"===n&&(i-=parseFloat(u),i-=parseFloat(o)),i}(t);let i,r=[];a(r,t,u);try{i=(0,o.breakLines)(r,n,{maxAdjustmentRatio:1})}catch(s){if(!(s instanceof o.MaxAdjustmentExceededError))throw s;r=[],a(r,t,u,e),i=(0,o.breakLines)(r,n)}s.push({el:t,items:r,breakpoints:i,lineWidth:n})})),s.forEach((({el:t,items:e,breakpoints:n,lineWidth:u})=>{const[o,r]=function(t,e){const n=[],u=[];for(let o=0;o<e.length-1;o++){let i=0,r=0;const s=0===o?e[o]:e[o]+1;for(let n=s;n<=e[o+1];n++){const u=t[n];"box"===u.type?i+=u.width:"glue"===u.type&&n!==s&&n!==e[o+1]?(i+=u.width,++r):"penalty"===u.type&&n===e[o+1]&&(i+=u.width)}n.push(i),u.push(r)}return[n,u]}(e,n),s=[],a=[];for(let u=1;u<n.length;u++){const o=e[n[u-1]],i=e[n[u]],r=document.createRange();u>1?r.setStart(o.node,o.end):r.setStart(t,0),r.setEnd(i.node,i.start),a.push(r),s.push("penalty"===i.type&&i.flagged)}t.style.whiteSpace="nowrap",a.forEach(((t,e)=>{if(0===e)return;const n=document.createElement("br");l(n),t.insertNode(n),t.setStart(n.nextSibling,0)})),a.forEach(((t,e)=>{const n=(u-o[e])/r[e];if(e===a.length-1&&n>=0)return;const h=function(t,e){const n=(0,i.textNodesInRange)(t,d);for(let t of n){const n=document.createElement("span");l(n),n.style.wordSpacing=`${e}px`,t.parentNode.replaceChild(n,t),n.appendChild(t)}return n}(t,n);if(s[e]&&h.length>0){const t=h[h.length-1],e=document.createTextNode("-");l(e),t.parentNode.appendChild(e)}}))}))}},959:function(t,e,n){"use strict";var u=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.createHyphenator=void 0;const o=u(n(573));e.createHyphenator=function(t){const e=new o.default(t);return t=>e.hyphenate(t)}},607:function(t,e,n){"use strict";var u=this&&this.__createBinding||(Object.create?function(t,e,n,u){void 0===u&&(u=n);var o=Object.getOwnPropertyDescriptor(e,n);o&&!("get"in o?!e.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,u,o)}:function(t,e,n,u){void 0===u&&(u=n),t[u]=e[n]}),o=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||u(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),o(n(839),e),o(n(382),e),o(n(240),e),o(n(959),e)},839:(t,e)=>{"use strict";function n(t){return"penalty"===t.type&&t.cost<=e.MIN_COST}Object.defineProperty(e,"__esModule",{value:!0}),e.forcedBreak=e.positionItems=e.adjustmentRatios=e.breakLines=e.MaxAdjustmentExceededError=e.MAX_COST=e.MIN_COST=void 0,e.MIN_COST=-1e3,e.MAX_COST=1e3;const u={maxAdjustmentRatio:null,initialMaxAdjustmentRatio:1,doubleHyphenPenalty:0,adjacentLooseTightPenalty:0};class o extends Error{}function i(t,e,n){const u=[];for(let i=0;i<n.length-1;i++){let r=(o=i,Array.isArray(e)?e[o]:e),s=0,a=0,l=0;const h=0===i?n[i]:n[i]+1;for(let e=h;e<=n[i+1];e++){const u=t[e];"box"===u.type?s+=u.width:"glue"===u.type&&e!==h&&e!==n[i+1]?(s+=u.width,a+=u.shrink,l+=u.stretch):"penalty"===u.type&&e===n[i+1]&&(s+=u.width)}let c;c=s<r?(r-s)/l:(r-s)/a,u.push(c)}var o;return u}e.MaxAdjustmentExceededError=o,e.breakLines=function t(i,r,s={}){if(0===i.length)return[];const a=Object.assign(Object.assign({},u),s),l=Math.min(a.initialMaxAdjustmentRatio,null!==a.maxAdjustmentRatio?a.maxAdjustmentRatio:1/0),h=new Set;h.add({index:0,line:0,fitness:0,totalWidth:0,totalStretch:0,totalShrink:0,totalDemerits:0,prev:null});let c=0,d=0,p=0,f=1/0;for(let u=0;u<i.length;u++){const g=i[u];if(g.width<0)throw new Error(`Item ${u} has disallowed negative width`);let y=!1;if("box"===g.type)c+=g.width;else if("glue"===g.type){if(g.shrink<0||g.stretch<0)throw new Error(`Item ${u} has disallowed negative stretch or shrink`);y=u>0&&"box"===i[u-1].type,y||(c+=g.width,p+=g.shrink,d+=g.stretch)}else"penalty"===g.type&&(y=g.cost<e.MAX_COST);if(!y)continue;let A=null;const C=[];if(h.forEach((t=>{let o=0;const s=p-t.totalShrink,y=d-t.totalStretch,B=(F=t.line,Array.isArray(r)?r[F]:r);var F;let m=c-t.totalWidth;if("penalty"===g.type&&(m+=g.width),o=m<B?(B-m)/y:(B-m)/s,o>l&&(f=Math.min(o,f)),(o<-1||n(g))&&(h.delete(t),A=t),o>=-1&&o<=l){let n;const r=100*Math.abs(o)**3,s="penalty"===g.type?g.cost:0;n=s>=0?(1+r+s)**2:s>e.MIN_COST?(1+r)**2-s**2:(1+r)**2;let l=0;const h=i[t.index];let f;"penalty"===g.type&&"penalty"===h.type&&g.flagged&&h.flagged&&(l=a.doubleHyphenPenalty),n+=l,f=o<-.5?0:o<.5?1:o<1?2:3,t.index>0&&Math.abs(f-t.fitness)>1&&(n+=a.adjacentLooseTightPenalty);let y=0,A=0,B=0;for(let t=u;t<i.length;t++){const n=i[t];if("box"===n.type)break;if("penalty"===n.type&&n.cost>=e.MAX_COST)break;y+=n.width,"glue"===n.type&&(A+=n.shrink,B+=n.stretch)}const F={index:u,line:t.line+1,fitness:f,totalWidth:c+y,totalShrink:p+A,totalStretch:d+B,totalDemerits:t.totalDemerits+n,prev:t};C.push(F)}})),C.length>0){let t=C[0];for(let e of C)e.totalDemerits<t.totalDemerits&&(t=e);h.add(t)}if(0===h.size){if(isFinite(f)){if(a.maxAdjustmentRatio===l)throw new o;return t(i,r,Object.assign(Object.assign({},s),{initialMaxAdjustmentRatio:2*f}))}h.add({index:u,line:A.line+1,fitness:1,totalWidth:c,totalShrink:p,totalStretch:d,totalDemerits:A.totalDemerits+1e3,prev:A})}"glue"===g.type&&(c+=g.width,d+=g.stretch,p+=g.shrink)}let g=null;h.forEach((t=>{(!g||t.totalDemerits<g.totalDemerits)&&(g=t)}));const y=[];let A=g;for(;A;)y.push(A.index),A=A.prev;return y.reverse(),y},e.adjustmentRatios=i,e.positionItems=function(t,e,n,u={}){const o=i(t,e,n),r=[];for(let e=0;e<n.length-1;e++){const i=Math.max(o[e],-1);let s=0;const a=0===e?n[e]:n[e]+1;for(let o=a;o<=n[e+1];o++){const l=t[o];if("box"===l.type)r.push({item:o,line:e,xOffset:s,width:l.width}),s+=l.width;else if("glue"===l.type&&o!==a&&o!==n[e+1]){let t;t=i<0?l.width+i*l.shrink:l.width+i*l.stretch,u.includeGlue&&r.push({item:o,line:e,xOffset:s,width:t}),s+=t}else"penalty"===l.type&&o===n[e+1]&&l.width>0&&r.push({item:o,line:e,xOffset:s,width:l.width})}}return r},e.forcedBreak=function(){return{type:"penalty",cost:e.MIN_COST,width:0,flagged:!1}}},685:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(){this._fonts=new Map,this._textWidths=new Map}putFont(t,e){this._fonts.set(t,e)}cssFontForElement(t){return this._fonts.get(t)}putWidth(t,e,n){let u=this._textWidths.get(t);u||(u=new Map,this._textWidths.set(t,u)),u.set(e,n)}getWidth(t,e){const n=this._textWidths.get(t);return n?n.get(e):null}}let u;e.default=class{constructor(){this._cache=new n}measure(t,e){let n=this._cache.cssFontForElement(t);n||(n=function(t){const e=getComputedStyle(t);let n=e.font;if(n.length>0)return n;const{fontStyle:u,fontVariant:o,fontWeight:i,fontSize:r,fontFamily:s}=e;return n=`${u} ${o} ${i} ${r} ${s}`,n}(t),this._cache.putFont(t,n));let o=this._cache.getWidth(n,e);return o||(o=function(t,e){if(!u){const t=document.createElement("canvas");u=t.getContext("2d")}return u.font=t,u.measureText(e).width}(n,e),this._cache.putWidth(n,e,o)),o}}},709:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.textNodesInRange=void 0,e.textNodesInRange=function(t,e){const n=t.commonAncestorContainer,u=n.ownerDocument.createTreeWalker(n,NodeFilter.SHOW_ALL,{acceptNode:t=>e(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT},!1);let o=u.currentNode,i=[];for(;o;)t.intersectsNode(o)&&o instanceof Text&&i.push(o),o=u.nextNode();return i}}},e={},function n(u){var o=e[u];if(void 0!==o)return o.exports;var i=e[u]={exports:{}};return t[u].call(i.exports,i,i.exports,n),i.exports}(607);var t,e}));
//# sourceMappingURL=lib.js.map